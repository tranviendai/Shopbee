@page
@model JZenoApp.Areas.Identity.Pages.Account.Manage.Bills.IndexModel
@using Microsoft.AspNetCore.Identity
@inject SignInManager<User> SignInManager
@inject UserManager<User> UserManager
@{
    ViewData["Title"] = "Index";
    int dem = 0, dem1 = 0, dem2 = 0, dem3 = 0, dem4 = 0, dem5 = 0;
}
<link href="~/css/profile.css" rel="stylesheet" />
<link href="~/css/ordercustomer.css" rel="stylesheet" />
<script src="~/js/jquery.min.js"></script>

<section id="tabs" style="margin-top:30px;">
    <div class="trangthai">
        <h6 class="section-title h1 text-left"></h6>
        <div class="row">
            <div class="col-xs-12 ">
                <nav class="asa">
                    <div class=" nav nav-tabs nav-fill" id="nav-tab" role="tablist">
                        <a class=" nav-link active" id="nav-cd-tab" data-toggle="tab" href="#nav-cd"
                           role="tab" aria-controls="nav-cd" aria-selected="true">Tất cả</a>
                        <a class=" nav-link" id="nav-home-tab" data-toggle="tab" href="#nav-home"
                           role="tab" aria-controls="nav-home" aria-selected="false">
                            Chờ Xử Lý
                            <img src="./image/new-logo.png" width="80" alt="">
                        </a>
                        <a class=" nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-profile"
                           role="tab" aria-controls="nav-profile" aria-selected="false">Đã Xác Nhận</a>

                        <a class=" nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-contact"
                           role="tab" aria-controls="nav-contact" aria-selected="false">Đang Giao</a>

                        <a class=" nav-link" id="nav-about-tab" data-toggle="tab" href="#nav-about"
                           role="tab" aria-controls="nav-about" aria-selected="false">Hoàn thành</a>

                        <a class=" nav-link" id="nav-huy-tab" data-toggle="tab" href="#nav-huy"
                           role="tab" aria-controls="nav-huy" aria-selected="false">Đã Hủy</a>

                        <a class=" nav-link" id="nav-hoan-tab" data-toggle="tab" href="#nav-hoan"
                           role="tab" aria-controls="nav-hoan" aria-selected="false">Trả hàng/Hoàn tiền</a>
                    </div>
                </nav>

                <div class="tab-content py-3 px-3 px-sm-0" id="nav-tabContent">
                    <div class="tab-pane fade show active" id="nav-cd" role="tabpanel"
                         aria-labelledby="nav-cd-tab">
                        <div class="container" style="max-width: 100%;">
                            @foreach (var item0 in Model.Bill.Where(e=>e.UserId == UserManager.GetUserId(User)))
                            {
                                <div class="order1">
                                    <div>@item0.billID | @Convert.ToDecimal(item0.price).ToString("N0") | @item0.date</div>
                                    @if(item0.detailsOrders!.Where(e=>e.detailStatic != 0).Count() == 0)
                                    {
                                        @if (item0.billStatic == 0)
                                        {
                                            <select id="selectActive" data-productid="@item0.billID" class="form-control">
                                                <option selected>
                                                    @switch (item0.billStatic)
                                                    {
                                                        case 0:
                                                            <div>Chờ Thanh Toán</div>
                                                            break;
                                                        case 1:
                                                            <div>Đã Hủy</div>
                                                            break;
                                                        default:
                                                            <div>Chưa Xử Lý</div>
                                                            break;
                                                    }
                                                </option>
                                                @if (item0.billStatic == 0)
                                                {
                                                    <option value="1">Đã Hủy</option>
                                                }
                                            </select>
                                        }
                                        else
                                        {
                                            <div>Đã Hủy</div>
                                        }
                                    }
                                    @foreach (var item1 in item0.detailsOrders!)
                                        {
                                            var x = 0;
                                                <div class="row">
                                                    <div class="col-10">
                                                        <span class="like">Yêu thích</span>
                                                        <span style="font-weight: 600; width: 100px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">@item1.Product!.Partner!.name</span>
                                                        <span class="shop"><i class='bx bx-store'></i><a style="text-decoration:none; color:black;" href="/Partners/Details/@item1.Product.partnerID">Xem shop</a></span>
                                                    </div>
                                                    <div class="col-2" style="color: red;display: flex; justify-content: right;">
                                                        @if (Convert.ToInt16(item1.detailStatic) == 0)
                                                        {
                                                            <span>Chờ Xử Lý</span>
                                                        }
                                                @if (Convert.ToInt16(item1.detailStatic) == 1)
                                                        {
                                                            <span>Đã Xác Nhận</span>
                                                        }
                                                @if (Convert.ToInt16(item1.detailStatic) == 2)
                                                        {
                                                            <span>Đang Giao</span>
                                                        }
                                                @if (Convert.ToInt16(item1.detailStatic) == 3)
                                                        {
                                                            <span>Hoàn thành</span>
                                                        }
                                                @if (Convert.ToInt16(item1.detailStatic) == 4)
                                                        {
                                                            <span>Đã Hủy</span>
                                                        }
                                                @if (Convert.ToInt16(item1.detailStatic) == 5)
                                                        {
                                                            <span>Trà hành/Hoàn tiền</span>
                                                        }
                                                    </div>
                                                </div>
                                                <div style="border-bottom: 1px solid rgb(232, 232, 232); margin: 20px 0px;">
                                                </div>
                                            <h2></h2>
                                            <div class="row">
                                                <div class="col-2">
                                                    @foreach (var hinh in item1.Product!.productImages!)
                                                    {
                                                        if (x == 0)
                                                        {
                                                            <img src="/images/products/@hinh.URL" width="90%" /> @* Hình ảnh sản phẩm *@
                                                        }
                                                        x++;
                                                    }
                                                </div>
                                                <div class="col-10">
                                                    <p style="font-size: 20px; font-weight: 600; margin-bottom: 0px;">@item1.Product.name</p>
                                                    <div class="row">
                                                        <div class="col-10" style="color: gray;padding-left:13px;">Phân loại hàng: @item1.size / @item1.color</div> @* màu với size *@
                                                        <div class="col-2" style="color: red; justify-content: right; display: flex;">@Convert.ToDecimal(item1.price * item1.quantity).ToString("N0")</div>
                                                    </div>
                                                <div>@Convert.ToDecimal(item1.price).ToString("N0") x @item1.quantity</div>
                                                </div>
                                            </div>
                                    }
                                </div>
                                <div class="pay">
                                    <div class="tt">
                                        <span style="margin-right: 3px; margin-top: -3px;"><img src="https://deo.shopeemobile.com/shopee/shopee-pcmall-live-sg/83e10a1f95cb083579c089448ef8dd3b.png" style="width: 23px; height: 24px;" class="sure-img"></span>
                                        <span class="tien">Thành tiền:&nbsp;</span>
                                        <span style="color: red; text-decoration: underline;">đ</span>
                                        <span class="toltal">@Convert.ToDecimal(item0.price).ToString("N0")</span>
                                    </div>
                                    <div class="row">
                                        <div class="col-5 note1">
                                            @if (Convert.ToInt16(item0.billStatic) == 0)
                                            {
                                                <span>Chờ Xử Lý</span>
                                            }
                                            @if (Convert.ToInt16(item0.billStatic) == 1)
                                            {
                                                <span>Bên vận chuyển đang đến lấy hàng</span>
                                            }
                                            @if (Convert.ToInt16(item0.billStatic) == 2)
                                            {
                                                <span>Đơn hàng đang giao đã đến bạn</span>
                                            }
                                            @if (Convert.ToInt16(item0.billStatic) == 3)
                                            {
                                                <span>Đánh giá sản phẩm trước 10/12/2023</span>
                                            }
                                            @if (Convert.ToInt16(item0.billStatic) == 4)
                                            {
                                                <span>Đã hủy bởi bạn</span>
                                            }
                                            @if (Convert.ToInt16(item0.billStatic) == 5)
                                            {
                                                <span>Trà hành/Hoàn tiền</span>
                                            }
                                        </div>
                                        <div class="col-7 phu">
                                            <button style="color: #fff; background-color: red; border: none; border-radius: 4px; padding: 5px 20px">Đánh giá</button>
                                            <button class="contactoorder">Liên hệ người bán</button>
                                            <button class="contactoorder">Mua lại</button>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>

    .container {
        padding-top: 0px;
    }

    .notorder {
        height: 370px;
        background-color: #fff;
        margin-top: 18px;
        justify-content: center;
        border-radius: 0px 0px 8px 8px;
        display: flex;
        box-shadow: 0 1px 1px 0 rgba(0,0,0,.05);
    }

        .notorder img {
            margin: auto;
            display: table;
            vertical-align: middle;
        }
</style>
<script src="~/js/bootstrap.bundle.min.js"></script>
<script>
    $('select[id^=selectActive]').on("change", function () {
        var id = $(this).attr('data-productid');
        var payment = $(this).find('option:selected').val();
        $.ajax({
            method: "PUT",
            url: "/Bills/updateActive/",
            data: {
                billId: id,
                payment: payment
            },
            dataType: "json",
            success: function (data) {
                window.location.href = "";
            }
        });
    });
</script>